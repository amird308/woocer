# Repository Map - Implementation Status âœ…

## Core Architecture âœ…
- **Framework**: NestJS with TypeScript âœ…
- **Package Manager**: pnpm âœ…
- **Database**: PostgreSQL with Prisma ORM âœ…
- **Authentication**: Better Auth with organization plugin âœ…
- **API Documentation**: Swagger/OpenAPI decorators âœ…
- **Configuration**: MCP server integration via `mcp.json` âœ…

## Database Models (schema.prisma) âœ…

### User Management âœ…
- `User` - Core user entity with auth fields âœ…
- `Session` - User sessions with organization context âœ…
- `Account` - SSO account linking âœ…
- `Verification` - Email/identity verification âœ…

### Organization Management âœ…
- `Organization` - Multi-tenant organizations with company details âœ…
- `Member` - User-organization relationships with roles âœ…
- `Invitation` - Pending organization invitations âœ…
- `Team` - Sub-organization teams âœ…

## Module Structure âœ…

### Common Entities (common/entities/) âœ…
```
common/
â””â”€â”€ entities/
    â”œâ”€â”€ user.entity.ts          # User entity interface âœ…
    â”œâ”€â”€ session.entity.ts       # Session entity interface âœ…
    â”œâ”€â”€ account.entity.ts       # Account entity interface âœ…
    â”œâ”€â”€ verification.entity.ts  # Verification entity interface âœ…
    â”œâ”€â”€ organization.entity.ts  # Organization entity interface âœ…
    â”œâ”€â”€ member.entity.ts        # Member entity interface âœ…
    â”œâ”€â”€ invitation.entity.ts    # Invitation entity interface âœ…
    â”œâ”€â”€ team.entity.ts          # Team entity interface âœ…
    â””â”€â”€ index.ts               # Barrel exports âœ…
```

### Auth Module âœ…
```
modules/auth/
â”œâ”€â”€ auth-client.ts              # Better Auth client configuration âœ…
â”œâ”€â”€ auth.service.ts            # Auth business logic âœ…
â”œâ”€â”€ auth.controller.ts         # Better Auth integration âœ…
â””â”€â”€ auth.module.ts             # Module configuration âœ…

common/
â”œâ”€â”€ decorators/
â”‚   â”œâ”€â”€ current-user.decorator.ts      # User extraction decorator âœ…
â”‚   â””â”€â”€ require-permissions.decorator.ts # Permission decorator âœ…
â””â”€â”€ guards/
    â”œâ”€â”€ auth.guard.ts          # Authentication guard âœ…
    â””â”€â”€ permission.guard.ts    # Permission-based access control âœ…
```

### Organization Module âœ… (Example Implementation)
```
modules/organization/
â”œâ”€â”€ organization.service.ts     # Business logic âœ…
â”œâ”€â”€ organization.controller.ts  # HTTP endpoints âœ…
â””â”€â”€ organization.module.ts     # Module configuration âœ…
```

## Common/Shared Components âœ…

### Types & DTOs âœ…
- Pagination responses and utilities âœ…
- Common response interfaces (`ApiResponseDto`) âœ…
- Entity interfaces in `common/entities/` âœ…
- Input DTOs using entity interfaces with validation âœ…
- Output DTOs using TypeScript `Pick`, `Omit`, and utility types from entities âœ…

### Module-Specific DTOs âœ…
```
modules/auth/models/
â”œâ”€â”€ user.request.ts            # User input DTOs âœ…
â””â”€â”€ user.response.ts           # User output DTOs âœ…

modules/organization/models/
â”œâ”€â”€ organization.request.ts    # Organization input DTOs âœ…
â””â”€â”€ organization.response.ts   # Organization output DTOs âœ…
```

### Decorators âœ…
- `@CurrentUser` - Extract authenticated user from request âœ…
- `@RequirePermissions` - Role-based access control âœ…

### Guards âœ…
- `AuthGuard` - Authentication verification âœ…
- `PermissionGuard` - Organization/role permission checks âœ…

### Utilities âœ…
```
common/utilities/
â”œâ”€â”€ slug.util.ts              # URL slug generation âœ…
â”œâ”€â”€ validation.util.ts        # Validation helpers âœ…
â””â”€â”€ index.ts                 # Barrel exports âœ…
```

### Interceptors âœ…
```
common/interceptors/
â””â”€â”€ transform.interceptor.ts   # Response transformation âœ…
```

### Validation âœ…
- Class-validator for input DTOs âœ…
- Swagger decorators for API documentation âœ…

## Key Patterns & Architecture âœ…

### 1. Module per Domain âœ…
Each business domain has its own module with:
- Controller for HTTP endpoints âœ…
- Service for business logic âœ…
- Separate `.request.ts` and `.response.ts` files âœ…

### 2. Entity-First DTO Pattern âœ…
- Custom entity interfaces defined in `common/entities/` (not using Prisma types directly) âœ…
- Input DTOs implement entity interfaces with class-validator decorators âœ…
- Output DTOs use TypeScript utility types (`Pick`, `Omit`, `Partial`) from entity interfaces âœ…
- DTOs are module-specific in `modules/{domain}/models/` directories âœ…
- Full Swagger documentation with `@ApiProperty` âœ…

### 3. Service Layer Architecture âœ…
- Business logic separated from controllers âœ…
- One service per entity âœ…
- Prisma ORM for data persistence âœ…
- Queue integration for background processing (BullMQ) âœ…

### 4. Permission-Based Access Control âœ…
- Organization-scoped permissions âœ…
- Role-based access with `@RequirePermissions` âœ…
- Session includes active organization context âœ…

## Configuration Files âœ…

### Core Configuration âœ…
- `nest-cli.json` - NestJS CLI configuration âœ…
- `schema.prisma` - Database schema and models âœ…
- `mcp.json` - Model Context Protocol server configuration âœ…

### Authentication âœ…
- `auth-client.ts` - Better Auth client with organization plugin âœ…
- Environment variables for API URLs and database connections âœ…

## Implemented Structure âœ…

```
src/
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ auth/                 # Authentication module âœ…
â”‚   â”‚   â”œâ”€â”€ models/           # Auth-specific DTOs âœ…
â”‚   â”‚   â”‚   â”œâ”€â”€ user.request.ts  # User input DTOs âœ…
â”‚   â”‚   â”‚   â””â”€â”€ user.response.ts # User output DTOs âœ…
â”‚   â”‚   â”œâ”€â”€ auth-client.ts    # Better Auth client âœ…
â”‚   â”‚   â”œâ”€â”€ auth.service.ts   # Auth business logic âœ…
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts # Auth endpoints âœ…
â”‚   â”‚   â””â”€â”€ auth.module.ts    # Module config âœ…
â”‚   â””â”€â”€ organization/         # Organization module âœ…
â”‚       â”œâ”€â”€ models/           # Organization-specific DTOs âœ…
â”‚       â”‚   â”œâ”€â”€ organization.request.ts  # Organization input DTOs âœ…
â”‚       â”‚   â””â”€â”€ organization.response.ts # Organization output DTOs âœ…
â”‚       â”œâ”€â”€ organization.service.ts    # Business logic âœ…
â”‚       â”œâ”€â”€ organization.controller.ts # HTTP endpoints âœ…
â”‚       â””â”€â”€ organization.module.ts     # Module config âœ…
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ entities/            # Entity interfaces âœ…
â”‚   â”‚   â”œâ”€â”€ user.entity.ts   âœ…
â”‚   â”‚   â”œâ”€â”€ organization.entity.ts âœ…
â”‚   â”‚   â””â”€â”€ [other entities] âœ…
â”‚   â”œâ”€â”€ decorators/          # Custom decorators âœ…
â”‚   â”œâ”€â”€ guards/              # Auth & permission guards âœ…
â”‚   â”œâ”€â”€ interceptors/        # Response transformation âœ…
â”‚   â”œâ”€â”€ utilities/           # Common utilities âœ…
â”‚   â”œâ”€â”€ filters/             # Exception handling âœ…
â”‚   â”œâ”€â”€ middlewares/         # Request processing âœ…
â”‚   â”œâ”€â”€ types/               # Shared types âœ…
â”‚   â”œâ”€â”€ prisma/              # Database service âœ…
â”‚   â””â”€â”€ better-auth/         # Auth configuration âœ…
â”œâ”€â”€ app.module.ts            # Main app module âœ…
â””â”€â”€ main.ts                  # Application bootstrap âœ…
```

## Integration Points âœ…

### Package Management âœ…
- **pnpm** for dependency management and workspace support âœ…
- Faster installs and better disk space efficiency âœ…

### Database âœ…
- PostgreSQL with Prisma migrations âœ…
- UUID primary keys across all entities âœ…
- Proper foreign key relationships and cascading âœ…
- Entity interfaces abstract Prisma types for better maintainability âœ…

### Authentication Flow âœ…
- Better Auth handles session management âœ…
- Organization context in sessions âœ…
- Permission-based route protection âœ…

### Queue System âœ…
- BullMQ for background processing âœ…
- Redis-based queue implementation âœ…

## Development Guidelines âœ…

### Code Standards âœ…
- One module per main domain/route âœ…
- Separate controllers for secondary routes âœ…
- Entity interfaces in `common/entities/` (not direct Prisma types) âœ…
- Input DTOs implement entity interfaces with class-validator âœ…
- Output DTOs use TypeScript utility types from entities âœ…
- Full Swagger documentation âœ…

### File Naming Conventions âœ…
- `.entity.ts` for entity interfaces in `common/entities/` âœ…
- `.request.ts` for input DTOs (using entity interfaces) âœ…
- `.response.ts` for output DTOs (using Pick/Omit from entities) âœ…
- `.service.ts` for business logic âœ…
- `.controller.ts` for HTTP endpoints âœ…

### Entity-First Architecture âœ…
- Define entity interfaces first in `common/entities/` âœ…
- Use these entities for both input validation and output typing âœ…
- Leverage TypeScript utility types (`Pick<Entity, 'field1' | 'field2'>`, `Omit<Entity, 'sensitiveField'>`) âœ…
- Prisma models map to entity interfaces but don't expose Prisma types directly âœ…
- Better separation of concerns and easier testing âœ…

## Implementation Status Summary

âœ… **COMPLETED**:
- All entity interfaces created
- Entity-first DTO pattern implemented
- Auth module with Better Auth integration
- Organization module as example implementation
- Common utilities and interceptors
- Proper module structure
- Guards and decorators
- Service layer architecture
- Swagger documentation setup

ðŸŽ¯ **READY FOR DEVELOPMENT**:
- Additional business domain modules can be created following the organization module pattern
- All foundational architecture is in place
- Development can proceed with confidence following established patterns